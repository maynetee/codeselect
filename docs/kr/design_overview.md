# 설계 개요

## 🎯 핵심 설계 원칙
1. **간결성(Simplicity)**: 사용자가 명령어 하나로 프로젝트 내 파일을 선택하고 쉽게 공유할 수 있어야 합니다.
2. **직관성(Interactivity)**: Curses 기반 UI를 제공하여 파일 선택을 직관적으로 수행할 수 있도록 합니다.
3. **확장성(Extensibility)**: 다양한 파일 선택 방식 및 출력 포맷을 추가할 수 있도록 설계합니다.
4. **최소 의존성(Minimal Dependencies)**: 표준 라이브러리만을 사용하여 추가 설치 없이 실행 가능하도록 합니다.
5. **친숙한 UX(Familiar UX)**: Vim과 같은 널리 알려진 도구의 조작 방식을 차용하여 학습 곡선을 최소화합니다.
6. **관심사 분리(Separation of Concerns)**: 모듈 간 명확한 책임 분리를 통해 유지보수성과 확장성을 향상시킵니다.

## 🏛 시스템 아키텍처
CodeSelect는 크게 **파일 트리 생성기**, **인터랙티브 파일 선택기**, **출력 생성기** 세 가지 주요 모듈로 구성됩니다.

### 📂 주요 모듈
1. **파일 트리 생성기 (`build_file_tree`)**
   - 프로젝트 디렉터리를 스캔하여 파일 트리를 생성합니다.
   - `.gitignore` 파일을 자동으로 파싱하여 패턴을 추출하고 불필요한 파일을 필터링합니다.
   - 다양한 `.gitignore` 패턴(와일드카드, 디렉토리 특정, 제외 패턴)을 해석하여 적용합니다.
   - 하드코딩 된 기본 무시 패턴(`.git`, `__pycache__` 등)과 `.gitignore` 패턴을 결합하여 사용합니다.
   - 내부적으로 `os.walk()`를 활용하여 디렉터리 구조를 순회합니다.

2. **인터랙티브 파일 선택기**
   - **파일 선택 인터페이스 (`selector.py`)**
     - `interactive_selection` 함수를 통해 선택 인터페이스 초기화 및 실행
   - **UI 컴포넌트 (`selector_ui.py`)**
     - `FileSelector` 클래스로 curses 기반 UI 구현
     - 화면 그리기, 키 입력 처리, 사용자 인터페이스 로직 포함
   - **동작 관리 (`selector_actions.py`)**
     - 파일 선택, 검색, 확장/축소 등의 동작 관련 함수 제공
     - `toggle_selection`, `apply_search_filter` 등의 핵심 기능 구현

3. **출력 생성기 (`write_output_file`)**
   - 선택된 파일을 지정된 형식(`txt`, `md`, `llm`)으로 변환하여 저장합니다.
   - 파일 간의 종속성을 분석하여 LLM이 이해하기 쉬운 방식으로 구조화합니다.
   - 필요할 경우 클립보드에 자동으로 복사하여 빠르게 공유할 수 있도록 합니다.

## 🔄 데이터 흐름
```
사용자 실행 → 디렉터리 스캔 → 파일 선택 UI → 선택된 파일 수집 → 파일 저장 및 출력
```
1. **사용자 실행**: `codeselect` 명령어 실행
2. **디렉터리 스캔**: 프로젝트의 전체 파일 목록을 분석
3. **파일 선택 UI**: 사용자가 curses UI에서 파일 선택 (탐색, 검색, 필터링)
4. **선택된 파일 수집**: `collect_selected_content`를 통해 필요한 파일을 수집
5. **파일 저장 및 출력**: 선택된 파일을 변환하여 저장하거나 클립보드로 복사

## 🔍 검색 및 필터링 설계
검색 기능은 다음과 같은 흐름으로 설계되었습니다:

1. **검색 모드 진입**: `/` 키를 통해 검색 모드 활성화
2. **정규식 지원**: 사용자 입력을 정규식으로 처리하여 강력한 필터링 지원
3. **트리 구조 유지**: 검색 결과에서도 디렉토리 계층 구조 표시
   - 일치하는 파일의 모든 부모 디렉토리가 표시됨
4. **필터링 해제**: ESC 키를 통해 전체 목록으로 복원

## 🔄 모듈 간 상호작용
파일 선택 모듈 간의 상호작용은 다음과 같이 이루어집니다:

1. **외부 인터페이스 (`selector.py`)**
   - `interactive_selection` 함수를 통해 UI 초기화 및 실행
   - `curses.wrapper`를 사용하여 터미널 환경 설정

2. **UI 모듈 (`selector_ui.py`)**
   - `FileSelector` 클래스가 사용자와의 상호작용 담당
   - 키 입력을 받아서 적절한 액션 함수 호출

3. **액션 모듈 (`selector_actions.py`)**
   - UI 모듈에서 요청한 동작 수행 (선택, 검색, 확장/축소)
   - 동작 결과를 UI 모듈에 반환하여 화면에 반영

## ⚙️ 설계 고려 사항
- **성능 최적화**: 대규모 프로젝트에서도 빠르게 파일을 탐색할 수 있도록 `os.walk()` 최적화.
- **확장 가능성**: 향후 다양한 프로젝트 구조를 지원할 수 있도록 모듈화된 구조 유지.
- **사용자 경험 개선**: 직관적인 UI 제공 및 불필요한 파일 자동 필터링.
- **Vim 사용자 친화적**: 널리 사용되는 Vim의 키 바인딩을 차용하여 학습 곡선 낮춤.
- **관심사 분리**: UI와 동작 로직 분리를 통한 코드 가독성 및 유지보수성 향상

## 🔍 향후 개선 사항
- **고급 필터링 옵션 추가**: 특정 확장자 포함/제외 옵션 지원
- **프로젝트 의존성 분석 심화**: `import` 및 `require` 관계를 더 정확하게 분석
- **다양한 출력 포맷 지원**: JSON, YAML 등의 추가 지원 고려
- **검색 기록 관리**: 이전 검색어 저장 및 쉬운 접근 지원
- **플러그인 시스템**: 사용자 정의 동작을 추가할 수 있는 플러그인 아키텍처 도입 검토